{"componentChunkName":"component---src-templates-blog-post-js","path":"/configure-fcm/","result":{"data":{"site":{"siteMetadata":{"title":"Pooya Golchian","author":"Pooya Golchian"}},"markdownRemark":{"id":"3043bc57-b0f0-50c7-bf62-b456e2460afd","excerpt":"Configuration firebase push notification with CDN At first, you add a CDN script in the HTML file. I’m using this library in my vue.js application on the Yiata…","html":"<h3>Configuration firebase push notification with CDN</h3>\n<p>At first, you add a CDN script in the HTML file. I’m using this library in my vue.js application on the Yiata website.\nThis website configures with Webpack and dotnet core 2.2.</p>\n<h3>Step-1-Add CDN</h3>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https://www.gstatic.com/firebasejs/7.14.1/firebase-app.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https://www.gstatic.com/firebasejs/7.14.1/firebase-messaging.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https://www.gstatic.com/firebasejs/7.14.1/firebase-analytics.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h2>Step-2-Config script</h2>\n<p>After adding this script at the end of body tags you are adding the firebase configs like below:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> firebaseConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n              apiKey<span class=\"token operator\">:</span> <span class=\"token constant\">YOUR_API_KEY</span><span class=\"token punctuation\">,</span>\n              authDomain<span class=\"token operator\">:</span> <span class=\"token constant\">YOUR_AUTH_DOMAIN</span><span class=\"token punctuation\">,</span>\n              databaseURL<span class=\"token operator\">:</span> <span class=\"token constant\">YOUR_DATABASE_URL</span><span class=\"token punctuation\">,</span>\n              projectId<span class=\"token operator\">:</span> <span class=\"token constant\">YOUR_PROJECT_ID</span><span class=\"token punctuation\">,</span>\n              storageBucket<span class=\"token operator\">:</span> <span class=\"token constant\">YOUR_STORAGE_BUCKET</span><span class=\"token punctuation\">,</span>\n              messagingSenderId<span class=\"token operator\">:</span> YOUR_messagingSenderId\"<span class=\"token punctuation\">,</span>\n              appId<span class=\"token operator\">:</span> <span class=\"token constant\">YOUR_APP_ID</span><span class=\"token punctuation\">,</span>\n              measurementId<span class=\"token operator\">:</span> YOURE_measurementId\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n            firebase<span class=\"token punctuation\">.</span><span class=\"token function\">initializeApp</span><span class=\"token punctuation\">(</span>firebaseConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            firebase<span class=\"token punctuation\">.</span><span class=\"token function\">analytics</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> messaging <span class=\"token operator\">=</span> firebase<span class=\"token punctuation\">.</span><span class=\"token function\">messaging</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            messaging<span class=\"token punctuation\">.</span><span class=\"token function\">requestPermission</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Have Permission\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> messaging<span class=\"token punctuation\">.</span><span class=\"token function\">getToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">token</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">,</span> token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Have not Permisstion\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'messaging'</span><span class=\"token punctuation\">,</span> messaging<span class=\"token punctuation\">)</span>\n            messaging<span class=\"token punctuation\">.</span><span class=\"token function\">onMessage</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">payload</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Message received. '</span><span class=\"token punctuation\">,</span> payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n              localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">.</span>collapse_key<span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">.</span>notification<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Step-3-Add firebase service worker</h3>\n<p>For initial firebase configuration and connect to this service, You must add service worker js file in the root of your project.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">importScripts</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://www.gstatic.com/firebasejs/7.14.1/firebase-app.js\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">importScripts</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://www.gstatic.com/firebasejs/7.14.1/firebase-messaging.js\"</span><span class=\"token punctuation\">)</span>\nfirebase<span class=\"token punctuation\">.</span><span class=\"token function\">initializeApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n              apiKey<span class=\"token operator\">:</span> <span class=\"token constant\">YOUR_API_KEY</span><span class=\"token punctuation\">,</span>\n              authDomain<span class=\"token operator\">:</span> <span class=\"token constant\">YOUR_AUTH_DOMAIN</span><span class=\"token punctuation\">,</span>\n              databaseURL<span class=\"token operator\">:</span> <span class=\"token constant\">YOUR_DATABASE_URL</span><span class=\"token punctuation\">,</span>\n              projectId<span class=\"token operator\">:</span> <span class=\"token constant\">YOUR_PROJECT_ID</span><span class=\"token punctuation\">,</span>\n              storageBucket<span class=\"token operator\">:</span> <span class=\"token constant\">YOUR_STORAGE_BUCKET</span><span class=\"token punctuation\">,</span>\n              messagingSenderId<span class=\"token operator\">:</span> YOUR_messagingSenderId\"<span class=\"token punctuation\">,</span>\n              appId<span class=\"token operator\">:</span> <span class=\"token constant\">YOUR_APP_ID</span><span class=\"token punctuation\">,</span>\n              measurementId<span class=\"token operator\">:</span> YOURE_measurementId\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> messaging <span class=\"token operator\">=</span> firebase<span class=\"token punctuation\">.</span><span class=\"token function\">messaging</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nmessaging<span class=\"token punctuation\">.</span><span class=\"token function\">setBackgroundMessageHandler</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">payload</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"[firebase-messaging-sw.js] Received background message \"</span><span class=\"token punctuation\">,</span>\n    payload\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> notificationTitle <span class=\"token operator\">=</span> <span class=\"token string\">\"Background Message Title\"</span>\n  <span class=\"token keyword\">const</span> notificationOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    body<span class=\"token operator\">:</span> <span class=\"token string\">\"Background Message body.\"</span><span class=\"token punctuation\">,</span>\n    icon<span class=\"token operator\">:</span> <span class=\"token string\">\"/firebase-logo.png\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>registration<span class=\"token punctuation\">.</span><span class=\"token function\">showNotification</span><span class=\"token punctuation\">(</span>\n    notificationTitle<span class=\"token punctuation\">,</span>\n    notificationOptions\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Step-4-Add manifest json file</h3>\n<p>At the last step, You must be added SENDER_ID to manifest.json file</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n<span class=\"token string\">\"gcm_sender_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">'GCM_SENDER_ID'</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Step-5-Use localStrorage to save notifications</h3>\n<p>Now you can read the local storage with getItem method to get nofications from local storage. You can set expiration date for your local storage (for example: 1 month)</p>","frontmatter":{"title":"Configure Firebase Cloud Messaging (FCM)","date":"April 25, 2020"}}},"pageContext":{"slug":"/configure-fcm/","previous":{"fields":{"slug":"/host-jekyll-theme-on-github/"},"frontmatter":{"title":"Host Your Jekyll Theme on GitHub With CloudFlare"}},"next":{"fields":{"slug":"/ssh-tunnel/"},"frontmatter":{"title":"Setup and configuration SSH tunnel and create the poor man's VPN on Linux, MacOs, Windows 10"}}}}}